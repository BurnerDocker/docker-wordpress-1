# nginx vhost server configuration

# from http://wiki.nginx.org/WordPress
location = /favicon.ico {
    log_not_found off;
    access_log off;
}

location = /robots.txt {
    allow all;
    log_not_found off;
    access_log off;
}

location / {
    # This is cool because no php is touched for static content. 
    # include the "?$args" part so non-default permalinks doesn't break when using query string
    try_files $uri $uri/ /index.php?$args;
}

# Caching
location ~* \.(ico|jpg|webp|jpeg|gif|css|png|js|ico|bmp|zip|woff)$ {
	access_log off;
	log_not_found off;
	add_header Pragma public;
	add_header Cache-Control "public";
    expires max;
}

location ~* \.(html)$ {
	access_log on;
	log_not_found on;
	add_header Pragma public;
	add_header Cache-Control "public";
	expires max;
}

# SECURITY
# Obfuscation rule (hide identifying files)
location ~* /(\.|wp-config.php|readme.html|licence.txt|readme.md|readme|licence) {
	return 404;
}

# Only allow GET , POST, and HEAD 
if ($request_method !~ ^(GET|POST|HEAD)$ ) {
	return 444;
}

# Disable viewing of hidden files (files starting with a dot)
location ~ /\. {
	deny  all;
}